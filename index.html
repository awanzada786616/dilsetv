<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dilse TV | Premium Live Streaming</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Righteous&family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <style>
        :root { --red: #e50914; --bg: #050505; --card: #121212; --glass: rgba(255, 255, 255, 0.03); }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            background-color: var(--bg); 
            color: #fff; 
            font-family: 'Poppins', sans-serif; 
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        /* Sparkling Animated Background */
        #sparkles { position: fixed; inset: 0; z-index: -1; pointer-events: none; }
        .dot { position: absolute; background: #fff; border-radius: 50%; opacity: 0.2; animation: float 5s infinite linear; }
        @keyframes float { 0% { transform: translateY(105vh) scale(0); } 100% { transform: translateY(-10vh) scale(1); } }

        /* Hero Poster Section */
        .hero { 
            width: 100%; height: 45vh; 
            background: linear-gradient(to bottom, transparent, var(--bg)), 
                        url('https://images.unsplash.com/photo-1504450758481-7338eba7524a?q=80&w=2000'); 
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;
            padding: 20px;
        }
        .hero h1 { font-family: 'Righteous', cursive; font-size: clamp(40px, 10vw, 75px); color: var(--red); text-shadow: 0 0 30px rgba(229, 9, 20, 0.5); }
        .hero p { color: #aaa; font-weight: 300; letter-spacing: 1px; margin-top: 10px; }

        /* Search Bar Modern */
        .search-container { margin-top: -30px; width: 90%; max-width: 600px; margin-left: auto; margin-right: auto; position: relative; z-index: 10; }
        .search-bar { width: 100%; padding: 18px 30px; border-radius: 50px; border: 1px solid var(--red); background: rgba(0,0,0,0.9); color: #fff; font-size: 16px; outline: none; box-shadow: 0 10px 40px rgba(0,0,0,0.8); transition: 0.3s; }
        .search-bar:focus { box-shadow: 0 0 20px rgba(229, 9, 20, 0.4); }

        /* Professional Video Player */
        .player-section { width: 95%; max-width: 1000px; margin: 40px auto; }
        .video-wrapper { position: relative; width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 20px; overflow: hidden; border: 1px solid #222; box-shadow: 0 0 40px rgba(229, 9, 20, 0.1); }
        video { width: 100%; height: 100%; }

        /* Stylish English Loading Overlay */
        #video-loader { position: absolute; inset: 0; background: #000; display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 20; }
        .loader-text { font-family: 'Righteous', cursive; font-size: 26px; color: var(--red); letter-spacing: 6px; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.3; transform: scale(0.95); } }

        /* Categories Tabs */
        .tabs { display: flex; gap: 12px; padding: 20px; overflow-x: auto; justify-content: center; scrollbar-width: none; }
        .tabs::-webkit-scrollbar { display: none; }
        .tab { padding: 12px 28px; background: #111; border-radius: 12px; cursor: pointer; border: 1px solid #222; white-space: nowrap; font-weight: 600; color: #777; transition: 0.3s; }
        .tab.active { background: var(--red); color: #fff; border-color: var(--red); box-shadow: 0 5px 20px rgba(229, 9, 20, 0.3); }

        /* Channels Grid */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; padding: 20px; max-width: 1200px; margin: auto; min-height: 400px; }
        .card { background: var(--card); padding: 30px 15px; border-radius: 20px; text-align: center; border: 1px solid #1a1a1a; cursor: pointer; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .card:hover { border-color: var(--red); transform: translateY(-10px); background: #1a0000; }
        .card i { font-size: 32px; color: var(--red); margin-bottom: 12px; display: block; }
        .card span { font-size: 13px; font-weight: 600; letter-spacing: 0.5px; display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

        /* Professional Footer */
        footer { padding: 80px 20px; text-align: center; border-top: 1px solid #111; margin-top: 50px; background: #000; }
        .wa-btn { background: #25d366; color: #000; padding: 15px 40px; border-radius: 50px; text-decoration: none; font-weight: 800; display: inline-flex; align-items: center; gap: 10px; margin-bottom: 30px; transition: 0.3s; box-shadow: 0 5px 15px rgba(37,211,102,0.3); }
        .wa-btn:hover { transform: scale(1.05); }
        .credit-box { font-size: 11px; color: #444; letter-spacing: 2px; line-height: 2; }
        .credit-box b { color: #fff; font-size: 16px; display: block; margin-top: 5px; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #222; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--red); }
    </style>
</head>
<body>

<div id="sparkles"></div>

<header style="position: absolute; top: 30px; left: 30px; z-index: 100;">
    <div style="font-family: 'Righteous'; color: #e50914; font-size: 30px; letter-spacing: 1px;">DILSE TV</div>
</header>

<section class="hero">
    <h1>DILSE TV</h1>
    <p>Premium Live HD Experience • The Heart of Streaming</p>
</section>

<div class="search-container">
    <input type="text" id="searchInput" class="search-bar" placeholder="Search Channels (e.g. Sports, Kids, Entertainment...)">
</div>

<div class="player-section">
    <div class="video-wrapper">
        <div id="video-loader">
            <div class="loader-text">DILSE TV LOADING...</div>
        </div>
        <video id="player" controls autoplay playsinline></video>
    </div>
</div>

<div class="tabs">
    <div class="tab active" data-cat="Sports">Live Sports</div>
    <div class="tab" data-cat="Entertainment">Entertainment</div>
    <div class="tab" data-cat="Kids Zone">Kids Zone</div>
</div>

<div class="grid" id="mainGrid"></div>

<footer>
    <a href="https://whatsapp.com/channel/0029Vb75PUl4NViorkmONR0T" class="wa-btn" target="_blank">
        <i class="fa-brands fa-whatsapp"></i> JOIN WHATSAPP CHANNEL
    </a>
    <div class="credit-box">
        DESIGNED & DEVELOPED BY
        <b>AWAI S HAIDER</b>
        © 2024 DILSE TV OFFICIAL • ALL RIGHTS RESERVED
    </div>
</footer>

<script>
(function(){
    const video = document.getElementById("player");
    const loader = document.getElementById("video-loader");
    const grid = document.getElementById("mainGrid");
    const search = document.getElementById("searchInput");
    
    let allChannels = [];
    let currentCat = "Sports";
    let hls = null;

    async function init() {
        createSparkles();
        grid.innerHTML = "<p style='grid-column:1/-1; text-align:center; color:#555;'>Connecting to Dilse TV Servers...</p>";
        try {
            const res = await fetch('/api/getChannels');
            allChannels = await res.json();
            loadCategory("Sports");
        } catch (e) {
            grid.innerHTML = "<p style='color:red; text-align:center; grid-column:1/-1;'>Server Connection Failed. Please refresh.</p>";
        }
    }

    function loadCategory(cat) {
        currentCat = cat;
        // Case-insensitive filtering to ensure we don't miss anything
        const filtered = allChannels.filter(c => c.group.toLowerCase().includes(cat.toLowerCase()));
        renderGrid(filtered);
    }

    function renderGrid(list) {
        grid.innerHTML = "";
        if(list.length === 0) {
            grid.innerHTML = "<p style='grid-column:1/-1; text-align:center; color:gray;'>No channels found in this category.</p>";
            return;
        }
        list.forEach(ch => {
            const card = document.createElement("div");
            card.className = "card";
            card.innerHTML = `<i class="fa-solid fa-circle-play"></i><span>${ch.name}</span>`;
            card.onclick = () => playStream(ch.url);
            grid.appendChild(card);
        });
    }

    function playStream(url) {
        loader.style.display = "flex";
        window.scrollTo({ top: 450, behavior: 'smooth' });
        if(hls) hls.destroy();
        if (Hls.isSupported()) {
            hls = new Hls(); hls.loadSource(url); hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => { video.play(); loader.style.display="none"; });
            hls.on(Hls.Events.ERROR, () => { loader.style.display="none"; });
        } else {
            video.src = url; video.play();
            video.onplaying = () => loader.style.display="none";
        }
    }

    // Modern Search Live
    search.oninput = (e) => {
        const val = e.target.value.toLowerCase();
        const filtered = allChannels.filter(c => c.group.toLowerCase().includes(currentCat.toLowerCase()) && c.name.toLowerCase().includes(val));
        renderGrid(filtered);
    };

    // Tab Logic
    document.querySelectorAll(".tab").forEach(t => {
        t.onclick = () => {
            document.querySelectorAll(".tab").forEach(x => x.classList.remove("active"));
            t.classList.add("active");
            loadCategory(t.dataset.cat);
        };
    });

    function createSparkles() {
        const c = document.getElementById('sparkles');
        for(let i=0; i<45; i++) {
            let s = document.createElement('div'); s.className = 'dot';
            s.style.left = Math.random()*100+'%'; 
            s.style.width = s.style.height = (Math.random()*3 + 1)+'px';
            s.style.animationDuration = (Math.random()*3+3)+'s';
            s.style.animationDelay = Math.random()*5+'s';
            c.appendChild(s);
        }
    }

    init();
})();
</script>
</body>
</html>
